(function(){var a,b;b=angular.module("kdNav",["ngRoute"]),b.provider("kdNav",["$routeProvider",function(b){return this._routes={},this._menus={},this._menus._add=function(a,b){return this[a],this[a]={prepared:!1,parsed:!1,items:b},this},this.configRoutes=function(a){var c,d;this._routes=a;for(d in this._routes)c=this._routes[d].extend,c&&(this._routes[d]=angular.extend({},this._routes[c],this._routes[d]),this._routes[c]["default"]&&(this._routes[d]["default"]=!1)),b.when(this._routes[d].route,this._routes[d]),this._routes[d]["default"]&&b.otherwise({redirectTo:this._routes[d].route});return this},this.addMenu=function(a,b){return this._menus._add(a,b),this},this.$get=["$rootScope","$route","$routeParams","$location",function(b,c,d,e){return new a(b,c,d,e,this._routes,this._menus)}],this}]),a=function(a,b,c,d,e,f){return this._breadcrumbs=[],this.getBreadcrumbs=function(){return this._breadcrumbs},this.getBreadcrumb=function(a){var b;return function(){var c,d,e,f;for(e=this.getBreadcrumbs(),f=[],c=0,d=e.length;d>c;c++)b=e[c],f.push(b.routeName===a);return f}.call(this)?b:void 0},this._addBreadcrumb=function(a,b){var c,d,f;for(d in e)c=e[d],c.route===a&&(f=d);return f&&this._breadcrumbs.push({routeName:f,label:e[f].label,params:b}),this},this._generateBreadcrumbs=function(){var a,d,e,f,g,h,i;for(this._breadcrumbs=[],f=[],d=b.current.originalPath.split("/"),""===d[1]&&d.splice(1,1),i=[],g=0,h=d.length;h>g;g++)a=d[g],f.push(a),e=f.join("/")||"/",i.push(this._addBreadcrumb(e,c));return i},this._prepareMenu=function(a,b){var c,d,f,g,h;for(null==b&&(b={}),h=[],f=0,g=a.length;g>f;f++){c=a[f],null==c.label&&(c.label=e[c.routeName].label);for(d in c.params)c.params[d]=c.params[d].toString();c.params=angular.extend({},b,c.params),h.push(c.children?this._prepareMenu(c.children,c.params):void 0)}return h},this._parseMenu=function(a){return function(b){var d,e,f,g,h,i,j,k,l;for(l=[],i=0,j=b.length;j>i;i++){e=b[i],e.active=e.current=!1,d=void 0,a._breadcrumbs.map(function(a,b){return a.routeName===e.routeName?d=b+1:void 0}),g=!0,k=e.params;for(f in k)h=k[f],h!==c[f]&&(g=!1);d&&g&&(e.active=!0,d===a.getBreadcrumbs().length&&(e.current=!0)),l.push(e.children?a._parseMenu(e.children,e.params):void 0)}return l}}(this),this.getMenu=function(a){var b;return!f[a],b=f[a],b.prepared||(this._prepareMenu(b.items),b.prepared=!0),b.parsed||(this._parseMenu(b.items),b.parsed=!0),b.items},this.addMenu=function(a,b,c){var d;return null==c&&(c=!1),f._add(a,b),c&&(d=c.$new(),d.menuName=a,d.$on("$destroy",function(){return function(a){return delete f[a.currentScope.menuName]}}(this))),this},this.createPath=function(a,b){var c,d,f;if(e[a]){d=e[a].route;for(c in b)f=b[c],d=d.replace(":"+c,f);return""+d}return void 0},a.$on("$routeChangeSuccess",function(a){return function(){var g,h,i,j,k;if(b.current.originalPath){for(j in e)g=e[j],g.route===b.current.originalPath&&g.forward&&(i=angular.extend({},c,g.params),d.path(a.createPath(g.forward,i)));a._generateBreadcrumbs(),k=[];for(h in f)k.push(f[h].parsed=!1);return k}}}(this)),this},b.directive("kdNavBreadcrumbs",["kdNav",function(a){var b;return b={restrict:"AE",transclude:!0,scope:{},link:function(b,c,d,e,f){return f(b,function(a){return c.append(a)}),b.$watch(function(){return a.getBreadcrumbs()},function(){return b.breadcrumbs=a.getBreadcrumbs()})}}}]),b.directive("kdNavMenu",["kdNav",function(a){var b;return b={restrict:"AE",transclude:!0,scope:{menuName:"@kdNavMenu"},link:function(b,c,d,e,f){return f(b,function(a){return c.append(a)}),b.$watch(function(){return a.getMenu(b.menuName)},function(){return b.menu=a.getMenu(b.menuName)})}}}]),b.directive("kdNavPath",["kdNav",function(a){var b;return b={restrict:"A",scope:{routeName:"@kdNavPath",params:"=kdNavParams"},link:function(b,c,d){var e;return e=function(){return d.$set("href","#"+a.createPath(b.routeName,b.params))},b.$watch("params",e,!0)}}}])}).call(this);